# How tos

## Docker Compose configuration limitations

Some of settings are not allowed in Docker Compose configuration file
when using it with Feater, namely:

- `container_name` cannot be used - these names cannot be prefixed with
  compose project name prefix generated by Feater and it wouldn’t be
  possible to have multiple instances based on the same Docker Compose
  configuration;

- `ports` cannot be exposed - like above, it wouldn’t be possible to
  expose ports from multiple instances in this case;;

- `restart` cannot be used - could cause some problems when removing
  instances; also in most cases if container is stopped it results from
  some errors in application that we want to avoid.

## Interpolation placeholders

Some interpolations placeholders are available when:

- using before build interpolation task,

- defining values of summary items in definition.

These placeholders include:

- instance UUID made available as `{{{instance_id}}}`;

- instance unique hash made available as `{{{instance_hash}}}`;

- proxy domains made available as
  `{{{proxy_domain__[proxied_port_id]}}}`;

- environmental variables made available as
  `{{{env__[variable_name]}}}`.

## Environmental variables

Some additional environmental variables are generated by Feater and it
is possible to proxy them to services/containers in Docker Compose
configuration or to use them when executing service commands with after
build tasks.

Some of these are directly related to interpolation placeholders
mentioned in the previous section:

- `FEATER_INSTANCE_ID`,

- `FEATER_INSTANCE_HASH`,

- `FEATER__PROXY_DOMAIN__[PROXIED_PORT_ID]`.

Other provide some paths that can be used inside Docker Compose
configuration:

- absolute paths to source directories on host machine (to be used to
  mount source as Docker volumes)
  `FEATER__HOST_SOURCE_PATH__[SOURCE_ID]`,

- absolute paths to source directories on feater_api container machine,
  `FEATER__GUEST_SOURCE_PATH__[SOURCE_ID]`,

- volume names for external volumes prepopulated with assets
  `FEATER__ASSET_VOLUME__[VOLUME_ID]`.

**TODO Replace host and guest paths with volume names.**

## Inspecting containers and volumes

All Docker containers and volumes for given instance are created based
on pattern `featerinstance{INSTANCE HASH}` where {INSTANCE_HASH} is a
hash that can be found in instance’s Environment tab as
`FEATER__INSTANCE_HASH` env variable (e.g. `featerinstance5d6fe38i`).
The prefix can be controlled by changing the value of
`FEATER_CONTAINER_NAME_PREFIX` env variable.

To list all Docker containers that are related to instances:

```bash
docker ps -a --filter name=featerinstance
```

To list all Docker volumes that are related to instances:

```bash
docker volume ls --filter name=featerinstance
```

## Availability of environmental variables

You need to be aware that environmental variables that are passed when
Docker Compose setup is run are available only for entrypoint script.

If some other processes are run inside container later (e.g. if some
workers are run using `supervisord`) they need to be passed these
variables explicitly.

## Example project

You can check
[sample project](https://github.com/boldare/feater-symfony-example)
prepared for Feater. It's comprised of PHP application based on Symfony,
as well as MySQL, Redis, Elasticsearch and MailCatcher.
